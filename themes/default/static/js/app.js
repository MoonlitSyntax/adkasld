(()=>{"use strict";let E=e=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()},L=(e,t=300)=>{let n;return(...d)=>{clearTimeout(n),n=setTimeout(()=>e(...d),t)}};function w(){let e=document.getElementById("search-button"),t=document.getElementById("algolia-search-mask"),n=document.getElementById("algolia-search-modal"),d=document.getElementById("algolia-search-input"),r=document.getElementById("algolia-search-results"),o=document.getElementById("algolia-search-summary"),s=document.getElementById("close-search-modal-btn")||document.querySelector(".close-button")||null;if(!e||!t||!n||!d||!r||!o)return;let l=null,c=!1,i=async()=>{if(l)return!0;if(c)return!1;c=!0;try{let a=await fetch("/search_index.json");if(!a.ok)throw new Error("fetch failed");return l=await a.json(),c=!1,!0}catch(a){return console.error("Failed to load search index",a),c=!1,!1}},u=async()=>{t.classList.add("active"),n.classList.add("active"),document.body.style.overflow="hidden",setTimeout(()=>d.focus(),200),await i()},m=()=>{t.classList.remove("active"),n.classList.remove("active"),document.body.style.overflow=""},y=a=>{if(!a||!a.length){r.innerHTML=`
          <div style="text-align:center;padding:40px 0;">
             <p style="color:var(--muted);">\u4EC0\u4E48\u90FD\u6CA1\u6709\u55B5~</p>
          </div>`,o.style.display="block",o.textContent="\u5171\u627E\u5230 0 \u6761\u7ED3\u679C";return}let g=a.slice(0,50);r.innerHTML=g.map(p=>`
        <div class="search-hit">
          <a href="/post/${p.slug}" target="_self">
            <strong>${p.title||p.slug}</strong>
            <small>${p.date} ${p.tags?"\xB7 "+p.tags.join(" "):""}</small>
          </a>
        </div>`).join(""),o.style.display="block",o.textContent=`\u5171\u627E\u5230 ${a.length} \u6761\u7ED3\u679C`},h=L(a=>{if(!a){r.innerHTML="",o.style.display="none";return}if(!l){c?r.innerHTML="<p>\u6B63\u5728\u52A0\u8F7D\u7D22\u5F15...</p>":r.innerHTML="<p>\u52A0\u8F7D\u7D22\u5F15\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5</p>";return}let g=a.toLowerCase(),p=l.filter(v=>!!(v.title&&v.title.toLowerCase().includes(g)||v.slug&&v.slug.toLowerCase().includes(g)||v.tags&&v.tags.some(q=>q.toLowerCase().includes(g))));y(p)},200),f=a=>{a.preventDefault(),u()};e.addEventListener("click",f),e.addEventListener("touchend",f),s&&s.addEventListener("click",m),t.addEventListener("click",a=>{a.target===t&&m()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&n.classList.contains("active")&&m()}),d.addEventListener("input",a=>h(a.target.value.trim()))}function b(){document.querySelectorAll(".c-code__btn--copy").forEach(e=>{e.addEventListener("click",()=>{let t=e.closest(".c-code");if(!t)return;let n=t.querySelector("pre");if(!n)return;let d=n.querySelectorAll("span.cl"),r=d.length?[...d].map(o=>o.textContent.replace(/\r?\n$/,"")).join(`
`):n.textContent.trimEnd();navigator.clipboard.writeText(r).then(()=>{e.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>e.innerHTML='<i class="fas fa-copy"></i>',1500)}).catch(()=>{let o=window.getSelection(),s=document.createRange();s.selectNodeContents(n),o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy")}catch{}o.removeAllRanges()})})}),document.querySelectorAll(".c-code__btn--fold").forEach(e=>{e.addEventListener("click",()=>{let t=e.closest(".c-code");if(!t)return;t.classList.toggle("c-code--folded");let n=e.querySelector("i"),d=t.classList.contains("c-code--folded");n&&(n.className=d?"fas fa-chevron-down":"fas fa-chevron-up")})})}function S(){let e=document.querySelector(".c-nav");if(!e)return;let t=window.scrollY;window.addEventListener("scroll",()=>{let n=window.scrollY;n>t&&n>50?e.classList.add("nav-hidden"):e.classList.remove("nav-hidden"),t=n},{passive:!0})}function x(){let e=document.querySelector(".c-post__toc"),t=document.querySelector(".c-post__toc-list"),n=e?e.querySelector(".c-post__toc-empty"):null,d=document.querySelector(".c-post__content");if(!e||!t||!d)return;let r=[...d.querySelectorAll("h1, h2, h3")];if(!r.length){n&&(n.style.display="flex");return}n&&(n.style.display="none"),t.innerHTML="";let o=new Map,s="";r.forEach(c=>{c.id||(c.id=c.textContent.trim().replace(/\s+/g,"-"));let i=parseInt(c.tagName[1],10)||2,u=document.createElement("li");u.className=`c-post__toc-item level-${i}`;let m=document.createElement("a");m.href=`#${c.id}`,m.textContent=c.textContent,u.appendChild(m),i===3?(o.has(s)||o.set(s,[]),o.get(s).push(u)):(t.appendChild(u),i===2&&(s=c.id))});let l=new IntersectionObserver(c=>{c.forEach(i=>{let u=i.target.id,m=t.querySelector(`a[href="#${u}"]`);if(m&&i.isIntersecting&&i.target.tagName==="H2"){if(t.querySelectorAll("a").forEach(f=>f.classList.remove("active-h2")),m.classList.add("active-h2"),t.querySelectorAll("li.level-3").forEach(f=>f.remove()),o.has(u)){let f=m.parentElement,a=o.get(u);for(let g=a.length-1;g>=0;g--)t.insertBefore(a[g],f.nextSibling)}let y=e.getBoundingClientRect(),h=m.getBoundingClientRect();if(h.top<y.top||h.bottom>y.bottom){let f=m.offsetTop-e.clientHeight/3;e.scrollTo({top:f,behavior:"smooth"})}}})},{rootMargin:"0px 0px -60% 0px",threshold:.6});r.forEach(c=>l.observe(c)),t.addEventListener("click",c=>{let i=c.target.closest("a");if(!i)return;c.preventDefault();let u=i.getAttribute("href").slice(1),m=document.getElementById(u);if(!m)return;let h=m.getBoundingClientRect().top+window.scrollY+-60;window.scrollTo({top:h,behavior:"smooth"})})}function _(){let e=o=>{let s=o.querySelector(".c-img__img");if(!s)return;let l=()=>{let c=s.naturalWidth,i=s.naturalHeight;if(c>0&&i>0){let u=c/i;o.style.setProperty("--aspect-ratio",u)}o.classList.add("is-loaded")};s.complete?l():(s.addEventListener("load",l,{once:!0}),s.addEventListener("error",()=>o.classList.add("is-error"),{once:!0}))};document.querySelectorAll(".c-img").forEach(e),new MutationObserver(o=>{for(let s of o)s.type==="childList"&&s.addedNodes.forEach(l=>{l.nodeType===1&&(l.matches(".c-img")?e(l):l.querySelectorAll(".c-img").forEach(e))})}).observe(document.body,{childList:!0,subtree:!0});let n=document.querySelector(".c-lightbox");n||(n=document.createElement("div"),n.className="c-lightbox",n.innerHTML='<img class="c-lightbox__img" alt=""/>',document.body.appendChild(n));let d=(o,s)=>{let l=n.querySelector(".c-lightbox__img");l.src=o,l.alt=s||"",n.classList.add("is-open"),document.documentElement.style.overflow="hidden"},r=()=>{n.classList.remove("is-open"),document.documentElement.style.overflow=""};n.addEventListener("click",r),window.addEventListener("keydown",o=>{o.key==="Escape"&&r()}),document.addEventListener("click",o=>{var i,u;let s=o.target.closest(".c-img");if(!s)return;let l=s.dataset.full||((i=s.querySelector(".c-img__img"))==null?void 0:i.src),c=((u=s.querySelector(".c-img__img"))==null?void 0:u.alt)||"";l&&(o.preventDefault(),d(l,c))})}function C(){document.addEventListener("submit",e=>{let t=e.target.closest("form[data-pager]");if(!t)return;e.preventDefault();let n=t.querySelector('input[name="p"]'),d=((n==null?void 0:n.value)||"").trim(),r=parseInt(d.replace(/[^\d]/g,""),10);(!Number.isFinite(r)||r<1)&&(r=1);let o=parseInt(t.dataset.total||"0",10);Number.isFinite(o)&&o>0&&(r=Math.min(Math.max(r,1),o));let s=t.dataset.base||"/",l=(t.dataset.mode||"section").toLowerCase(),c;l==="home"?c=r<=1?"/":`/page/${r}`:c=r<=1?s:`${s}/${r}`,location.href=c},{passive:!1}),document.addEventListener("keydown",e=>{if(e.key!=="Enter")return;let t=e.target&&e.target.closest&&e.target.closest("form[data-pager]");t&&(t.requestSubmit?t.requestSubmit():t.dispatchEvent(new Event("submit",{cancelable:!0})))},{passive:!0})}E(()=>{w(),b(),S(),x(),_(),C()})})();
